<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=BIZ+UDMincho&family=BIZ+UDPGothic&family=IBM+Plex+Sans+JP&family=Space+Grotesk:wght@300..700&display=swap"
        rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/ScrollTrigger.min.js"></script>
</head>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    .biz-udmincho-regular {
        font-family: "BIZ UDMincho", serif;
        font-weight: 400;
        font-style: normal;
    }

    @font-face {
        font-family: 'SUIT';
        src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_suit@1.0/SUIT-Thin.woff2') format('woff2');
        font-weight: 100;
        font-style: normal;
    }

    @font-face {
        font-family: 'SUIT';
        src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_suit@1.0/SUIT-ExtraLight.woff2') format('woff2');
        font-weight: 200;
        font-style: normal;
    }

    @font-face {
        font-family: 'SUIT';
        src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_suit@1.0/SUIT-Light.woff2') format('woff2');
        font-weight: 300;
        font-style: normal;
    }

    @font-face {
        font-family: 'SUIT';
        src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_suit@1.0/SUIT-Regular.woff2') format('woff2');
        font-weight: 400;
        font-style: normal;
    }

    @font-face {
        font-family: 'SUIT';
        src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_suit@1.0/SUIT-Medium.woff2') format('woff2');
        font-weight: 500;
        font-style: normal;
    }

    @font-face {
        font-family: 'SUIT';
        src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_suit@1.0/SUIT-SemiBold.woff2') format('woff2');
        font-weight: 600;
        font-style: normal;
    }

    @font-face {
        font-family: 'SUIT';
        src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_suit@1.0/SUIT-Bold.woff2') format('woff2');
        font-weight: 700;
        font-style: normal;
    }

    @font-face {
        font-family: 'SUIT';
        src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_suit@1.0/SUIT-ExtraBold.woff2') format('woff2');
        font-weight: 800;
        font-style: normal;
    }

    @font-face {
        font-family: 'SUIT';
        src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_suit@1.0/SUIT-Heavy.woff2') format('woff2');
        font-weight: 900;
        font-style: normal;
    }

    .space-grotesk {
        font-family: "Space Grotesk", sans-serif;
        font-optical-sizing: auto;
        font-weight: 400;
        font-style: normal;
    }

    @import url('https://fonts.cdnfonts.com/css/avenir');

    body,
    html {
        width: 100vw;
        height: auto;
        margin: 0;
        padding: 0;
        background-color: #DBD3C8;
        /* background-image: url('./img/종이질감.png'); */
        background-size: cover;
        /* border: 1px solid red; */
        overflow-x: hidden;
        /* overflow: hidden; */
        font-family: 'Avenir', sans-serif;
    }

    header {
        position: fixed;
        top: 0;
        left: 0;
        display: flex;
        /* border: 1px solid red; */
        justify-content: center;
        align-items: center;
        padding: 1.5vw;
        z-index: 30;
        /* border: 1px solid red; */
        width: 100vw;
        transition: all 0.5s ease;
        border-radius: 0 0 1.1vw 1.1vw;
    }

    header .logo-name {
        /* width: 4.5vw; */
        font-size: 1.5vw;
        position: relative;
        right: 42vw;
        font-family: "BIZ UDMincho", serif;
        font-weight: 300;
    }

    header ul {
        display: flex;
        list-style-type: none;
        /* border: 1px solid red; */
        position: absolute;
        left: 72vw;
    }

    header ul li {
        padding: 1.5vw;
    }

    header a {
        text-decoration: none;
        color: #673C0A;
        font-family: 'SUIT';
        transition: all 0.5s ease;
        font-size: 0.9vw;
    }

    header.scroll {
        background-color: rgba(255, 255, 255, 0.151);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        transition: background-color 0.5s ease, backdrop-filter 0.5s ease;
    }


    header.scroll li a,
    header.scroll .logo-name {
        color: #F7F8F8;
    }

    #package-content {
        width: 100vw;
        min-height: 54vw;
        /* border: 3px solid red; */
        display: flex;
        flex-flow: column;
        justify-content: center;
        align-items: center;
        /* background-image: url('img/value-bg.png');
        background-position: center -5vw;
        background-size: cover;
        background-repeat: no-repeat; */
        padding-top: 4vw;
    }

    #package-content h2 {
        font-family: 'SUIT';
        font-weight: 400;
        font-size: 2vw;
    }

    .package {
        position: relative;
        width: 42vw;
        height: 42vw;
        padding: 16px;
        border-radius: 8px;
        overflow: visible;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        opacity: 1;
    }

    .text-line {
        position: absolute;
        cursor: grab;
        font-size: 16px;
        user-select: none;
        background: transparent;
        transition: font-size 0.2s ease;
        color: #673C0A;
    }

    .text-line.selected {
        outline: 0.08vw solid #673C0A;
        /* background-color: #fff; */
        /* 흰색 배경 적용 */
        /* background: transparent;  ← 이 줄 지우거나 주석 처리 */
        outline-offset: 0vw;
        padding: 0;
        border-radius: 0.1vw;
        transition: outline-color 0.2s ease, box-shadow 0.2s ease;
    }


    .controls {
        display: flex;
        /* flex-direction: column; */
        justify-content: center;
        align-items: center;
        gap: 1rem;
        /* align-items: center; */
    }

    .controls label {
        font-size: 14px;
    }

    input[type="color"],
    input[type="number"] {
        font-size: 1vw;
        padding: 0.43vw 1.2vw;
        border: 1px solid #673C0A;
        background: #673C0A;
        cursor: pointer;
        border-radius: 0.3vw;
        color: #fff;
    }

    .trash {
        font-size: 1vw;
        padding: 0.4vw 1vw;
        border: 1px solid #673C0A;
        background: #673C0A;
        cursor: pointer;
        border-radius: 0.3vw;
        color: #fff;
    }

    .undo-btn {
        font-size: 1vw;
        padding: 0.4vw 1vw;
        border: 1px solid #673C0A;
        background: #673C0A;
        cursor: pointer;
        border-radius: 0.3vw;
        color: #fff;
    }


    #saveBtn {
        font-size: 1vw;
        padding: 0.4vw 1vw;
        border: 1px solid #673C0A;
        background: #673C0A;
        cursor: pointer;
        border-radius: 0.3vw;
        color: #fff;
    }

    .package-area {
        display: flex;
        justify-content: center;
        align-items: center;
        /* border: 1px solid red; */
        position: relative;
        right: 4.9vw;
        /* transition: all 0.3s ease-in-out; */
    }

    .controls {
        display: flex;
        flex-flow: column;
        align-items: first baseline;
        width: 10vw;
        height: 18vw;
        /* border-radius: 1vw;
        padding: 1vw;
        background-color: #ffffff2d;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        position: relative;
        bottom: 7.1vw; */
    }

    #package-content h1 {
        font-size: 3vw;
        color: #673C0A;
    }


    #package-content p {
        font-size: 1.4vw;
        color: #673C0A;
        width: 44vw;
        text-align: right;
    }

    .txt-content {
        display: flex;
        flex-flow: column;
        /* border: 1px solid red; */
        /* justify-content: right; */
        align-items: self-end;
        position: relative;
        bottom: 2vw;
        left: 18vw;
        font-family: 'Avenir', sans-serif;
    }

    #last-txt {
        width: 100vw;
        min-height: 20vw;
        display: flex;
        flex-flow: column;
        justify-content: center;
        align-items: center;
    }

    #last-txt h2 {
        color: #673C0A;
        font-size: 2vw;
    }

    #last-txt h1 {
        color: #673C0A;
        font-size: 2vw;
        position: relative;
        top: 10vw;
    }
</style>

<body>
    <header>
        <a class="logo-name" href="index.html">
            <p>原硏哉</p>
        </a>
        <ul>
            <li><a href="index.html#hara">ABOUT</a></li>
            <li><a href="nav.html">DESIGN</a></li>
            <li><a href="value.html">EMPTINESS</a></li>
        </ul>
    </header>

    <section id="package-content">
        <h1>Begin Your Own Emptiness</h1>
        <div class="package-area">
            <div class="controls">
                <div>
                    <label>Font size</label> <br>
                    <input type="number" id="fontSizeInput" value="16" min="8" max="40" />
                </div>

                <div class="trash" id="trash">Delete</div>
                <button class="undo-btn" onclick="undoDelete()">Revert</button>

                <button id="saveBtn">Save</button>
            </div>

            <div class="package" id="package" style="background-image: url('package-box.png');">
                <div class="text-line" draggable="true"
                    style="position: absolute; top: 5vw; left: 3vw; font-size: 2.6vw; font-family: 'Avenir', sans-serif; font-weight: 700;">
                    MUJI™
                </div>

                <div class="text-line" draggable="true" style="top: 6.5vw; left: 13vw;font-size: 1vw; ">120ml / Made in
                    Japan</div>

                <div class="text-line" draggable="true" style="top: 9.2vw; left: 3.1vw;font-size: 1.1vw; ">Less is more,
                    당신의 피부에 필요한 것만 남겨두었습니다.</div>

                <div class="text-line" draggable="true" style="top: 11.5vw; left: 3vw;font-size: 1.7vw; ">Pure Essence
                    Face
                    Mist</div>


                <div class="text-line" draggable="true" style="top: 13.5vw; left: 3vw; font-size:1.7vw;">
                    Refreshing hydration for your sensitive skin.
                </div>



                <div class="text-line" draggable="true" style="top: 16.6vw; left: 3vw; font-size:1vw;">
                    주요 성분: Water (Aqua), Aloe Vera Extract, Chamomile Extract, Glycerin
                </div>


                <div class="text-line" draggable="true" style="top: 19vw; left: 3vw; font-size:1vw;">
                    사용법: 얼굴에서 20cm 떨어져 고르게 분사해 주세요. 아침, 저녁 사용 권장.
                </div>

                <div class="text-line" draggable="true" style="top: 20.5vw; left: 3vw; font-size:1vw;">
                    더운 여름날 냉장고에 넣어 보관하시면 시원한 미스트 사용이 가능합니다.
                </div>

                <div class="text-line" draggable="true" style="top: 22vw; left: 3vw; font-size:1vw;">
                    피부 당김이 느껴질 때 수시로 뿌려주세요.
                </div>

                <div class="text-line" draggable="true" style="top: 25vw; left: 3vw; font-size:1vw;">
                    저자극 테스트 완료
                </div>

                <div class="text-line" draggable="true" style="top: 25vw; left: 12vw; font-size:1vw;">
                    피부결 개선 테스트 완료
                </div>

                <div class="text-line" draggable="true" style="top: 28vw; left: 3vw; font-size:0.8vw;">
                    일본의 알프스 정제수만을 사용했습니다.
                </div>


                <div class="text-line" draggable="true" style="top: 29.2vw; left: 3vw; font-size:0.8vw;">
                    주의 사항: 직사광선을 피해 서늘한 곳에 보관하세요.
                </div>

                <div class="text-line" draggable="true" style="top: 31.4vw; left: 3vw; font-size:1vw;">
                    사용 중 피부 이상 시 사용을 중단하세요.
                </div>


                <div class="text-line" draggable="true" style="top: 33.9vw; left: 3vw; font-size:0.75vw;">
                    제조사: Manufactured by MUJI Co., Ltd.<br>
                    고객센터: 1234-5678
                </div>


                <div class="text-line" draggable="true" style="top: 33.9vw; left: 18vw; font-size:11px;">
                    바코드: 1234 5678 9012
                </div>
            </div>
        </div>


        <!-- <div class="txt-content">
            <h1>Begin Your Own Emptiness</h1>
            <p>“Begin Your Own Emptiness” is an interactive experience where you can explore Kenya Hara’s design
                philosophy
                firsthand.
                Clear away the unnecessary and create your own simple, essential product packaging. Discover a unique
                journey of finding
                true value within simplicity.</p>
        </div> -->

    </section>

    <!-- <section id="last-txt">
        <h2>
            "Emptiness is not the absence of everything,
            but the presence of only the essential."
        </h2>

        <h1>
            "What sense of emptiness did you leave behind?"
        </h1>
    </section> -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        const packageBox = document.getElementById("package");
        const bgColorPicker = document.getElementById("bgColorPicker");
        const fontSizeInput = document.getElementById("fontSizeInput");
        const trash = document.getElementById("trash");
        const undoBtn = document.querySelector(".undo-btn");

        let selected = null;
        let deletedStack = [];
        let historyStack = [];  // 상태 저장 스택

        // 상태 저장 함수 (모든 text-line 상태를 기록)
        // 상태 저장 함수 수정
        function saveState() {
            const lines = Array.from(packageBox.querySelectorAll('.text-line')).map(el => {
                const cs = window.getComputedStyle(el);
                return {
                    content: el.innerText,
                    fontSize: el.style.fontSize || cs.fontSize,
                    top: el.style.top,
                    left: el.style.left,
                    color: cs.color,
                    fontWeight: cs.fontWeight,    // ← 여기 추가
                    id: el.dataset.id
                };
            });
            historyStack.push(lines);
        }

        // 상태 복원 함수 수정
        function restoreState(state) {
            packageBox.innerHTML = '';
            state.forEach(line => {
                const newLine = document.createElement("div");
                newLine.className = "text-line";
                newLine.innerText = line.content;
                newLine.style.fontSize = line.fontSize;
                newLine.style.top = line.top;
                newLine.style.left = line.left;
                newLine.style.color = line.color;
                newLine.style.fontWeight = line.fontWeight;  // ← 여기 추가
                newLine.setAttribute("draggable", "false");
                packageBox.appendChild(newLine);
                attachDragHandlers(newLine);
            });
        }


        // 기존 패키지 박스 클릭 이벤트 (문장 선택 처리)
        packageBox.addEventListener("click", (e) => {
            if (e.target.classList.contains("text-line")) {
                if (selected) selected.classList.remove("selected");
                selected = e.target;
                selected.classList.add("selected");
                fontSizeInput.value = parseInt(window.getComputedStyle(selected).fontSize);
            }
        });

        // 패키지 외부 클릭 시 선택 해제 처리
        document.addEventListener("click", (e) => {
            const target = e.target;
            // 예외 처리 대상 요소들
            const isTextLine = target.classList.contains("text-line");
            const isInPackage = packageBox.contains(target);
            const isInControls = document.querySelector('.controls').contains(target);

            if (!isTextLine && !isInPackage && !isInControls) {
                if (selected) {
                    selected.classList.remove("selected");
                    selected = null;
                    fontSizeInput.value = 16; // 필요시 기본값 초기화
                }
            }
        });



        // 폰트 크기 조절
        fontSizeInput.addEventListener("input", (e) => {
            if (selected) {
                saveState();
                selected.style.fontSize = `${e.target.value}px`;
            }
        });

        // 배경 색 변경
        // bgColorPicker.addEventListener("input", (e) => {
        //     saveState();
        //     packageBox.style.backgroundColor = e.target.value;
        // });

        // 드래그 삭제
        let dragged = null;
        packageBox.addEventListener("dragstart", (e) => {
            if (e.target.classList.contains("text-line")) {
                dragged = e.target;
            }
        });

        trash.addEventListener("dragover", (e) => {
            e.preventDefault();
            trash.style.background = "#aa3333";
        });

        trash.addEventListener("dragleave", () => {
            trash.style.background = "#ccc";
        });

        trash.addEventListener("drop", () => {
            if (dragged) {
                saveState();
                deletedStack.push({
                    content: dragged.innerText,
                    fontSize: dragged.style.fontSize || "16px",
                    top: dragged.style.top,
                    left: dragged.style.left,
                    color: dragged.style.color || "black"
                });
                dragged.remove();
                trash.style.background = "#ccc";
                dragged = null;
            }
        });

        // 되돌리기 (Undo)
        function undoDelete() {
            if (historyStack.length === 0) return;
            const prevState = historyStack.pop();
            restoreState(prevState);
            selected = null;
            fontSizeInput.value = 16;
        }

        // 새 문장에 드래그 핸들러 붙이는 함수
        function attachDragHandlers(el) {
            let offsetX, offsetY;
            el.style.position = 'absolute';
            el.style.cursor = 'grab';

            el.addEventListener('mousedown', (e) => {
                e.preventDefault();
                offsetX = e.clientX - el.getBoundingClientRect().left;
                offsetY = e.clientY - el.getBoundingClientRect().top;
                el.style.zIndex = 1000;

                function onMouseMove(e) {
                    el.style.left = `${e.clientX - packageBox.getBoundingClientRect().left - offsetX}px`;
                    el.style.top = `${e.clientY - packageBox.getBoundingClientRect().top - offsetY}px`;
                }

                function onMouseUp(e) {
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                    el.style.zIndex = 1;

                    // 마우스 위치가 trash 안인지 체크
                    const trashRect = trash.getBoundingClientRect();
                    if (
                        e.clientX >= trashRect.left &&
                        e.clientX <= trashRect.right &&
                        e.clientY >= trashRect.top &&
                        e.clientY <= trashRect.bottom
                    ) {
                        // 삭제 처리
                        saveState();
                        deletedStack.push({
                            content: el.innerText,
                            fontSize: el.style.fontSize || "16px",
                            top: el.style.top,
                            left: el.style.left,
                            color: el.style.color || "black"
                        });
                        el.remove();
                    } else {
                        // 그냥 위치만 변경된 거 저장
                        saveState();
                    }
                }

                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            });
        }


        // 초기 문장들에 드래그 핸들러 붙이기
        document.querySelectorAll('.text-line').forEach(el => {
            el.style.position = 'absolute'; // 꼭 위치 지정 필요
            attachDragHandlers(el);
        });

        // 초기 상태 저장
        saveState();


        const saveBtn = document.getElementById('saveBtn');

        saveBtn.addEventListener('click', () => {
            // 패키지 영역을 캡처
            html2canvas(packageBox).then(canvas => {
                // 캔버스를 이미지 데이터 URL로 변환
                const dataURL = canvas.toDataURL('image/png');

                // 다운로드 링크 생성
                const link = document.createElement('a');
                link.href = dataURL;
                link.download = 'my-muji-package.png';

                // 강제로 클릭해서 다운로드 시작
                link.click();
            });
        });


        gsap.from(
            "#package-content h1",
            {
                y: "10vw", //8vw아래에서 시작
                opacity: 0, //투명인 상태에서 시작
                duration: 1.3, //얼마동안 이 모션을 진행할건지 - 숫자가 커질수록 느려짐
                ease: "power1.out",
                delay: 0.4,
                stagger: 0.15, //각 애미메이션 사이에 0.15초의 지연을 둠
                scrollTrigger: {
                    trigger: "#package-content",   // → trigger 를 h2 로
                    start: "top bottom",                // h2 의 top 이 뷰포트 bottom 에 닿을 때
                    toggleActions: "play reverse play reverse", // 나타날때마다 모션 진행
                    markers: false //페이지에 스크롤 위치 마커
                }
            }
        );

        gsap.from(
            ".package",
            {
                y: 0, //8vw아래에서 시작
                opacity: 0, //투명인 상태에서 시작
                duration: 1.3, //얼마동안 이 모션을 진행할건지 - 숫자가 커질수록 느려짐
                ease: "power1.out",
                delay: 1,
                stagger: 0.15, //각 애미메이션 사이에 0.15초의 지연을 둠
                scrollTrigger: {
                    trigger: ".package",   // → trigger 를 h2 로
                    start: "top bottom",                // h2 의 top 이 뷰포트 bottom 에 닿을 때
                    toggleActions: "play reverse play reverse", // 나타날때마다 모션 진행
                    markers: false //페이지에 스크롤 위치 마커
                }
            }
        );

        gsap.from(
            ".controls",
            {
                x: "-5vw", //8vw아래에서 시작
                opacity: 0, //투명인 상태에서 시작
                duration: 1.3, //얼마동안 이 모션을 진행할건지 - 숫자가 커질수록 느려짐
                ease: "power1.out",
                delay: 1,
                stagger: 0.15, //각 애미메이션 사이에 0.15초의 지연을 둠
                scrollTrigger: {
                    trigger: ".controls",   // → trigger 를 h2 로
                    start: "top bottom",                // h2 의 top 이 뷰포트 bottom 에 닿을 때
                    toggleActions: "play reverse play reverse", // 나타날때마다 모션 진행
                    markers: false //페이지에 스크롤 위치 마커
                }
            }
        );

    </script>
</body>

</html>